<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="google-site-verification" content="YckmxocC_Bwe2PGX-RvpCd3SJ5w3dtQom9RmH-wygj4" />
    <title>CatsBlock Weather</title>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <style>
        :root { --blue: #38bdf8; --dark: #0f172a; }
        body, html { margin: 0; padding: 0; font-family: 'Outfit', sans-serif; color: white; min-height: 100vh; overflow-x: hidden; background: none; }
        #bg-overlay { position: fixed; inset: 0; background: linear-gradient(to bottom, rgba(255,255,255,0.4) 0%, rgba(0,0,0,0.7) 100%); z-index: -1; transition: background 2s ease; }
        #weather-canvas { position: fixed; inset: 0; pointer-events: none; z-index: -1; }
        .night-mask { position: fixed; inset: 0; background: rgba(0,0,0,0.5); z-index: -1; display: none; }

        /* COBERTURA DE NUVENS */
        @keyframes moveCloud { from { right: -60px; } to { right: 110%; } }
.frame-cloud-icon { position: absolute; animation: moveCloud linear infinite; pointer-events: none; }
        
        /* EFEITOS DE CLIMA */
        .lightning-flash { position: fixed; inset: 0; background: white; opacity: 0; z-index: 10; pointer-events: none; }
        @keyframes flash { 0%, 90%, 100% { opacity: 0; } 92% { opacity: 0.6; } 94% { opacity: 0.2; } 96% { opacity: 0.9; } }
        .cloud-element { position: absolute; background: rgba(255,255,255,0.15); border-radius: 50%; filter: blur(40px); animation: drift linear infinite; }
        @keyframes drift { from { transform: translateX(-350px); } to { transform: translateX(110vw); } }
        .rain-drop { position: absolute; width: 2px; height: 18px; background: rgba(255,255,255,0.4); animation: fall linear infinite; }
        .snow-flake { position: absolute; background: #fff; border-radius: 50%; animation: snow linear infinite; }
        @keyframes fall { to { transform: translateY(110vh); } }
        @keyframes snow { 0% { transform: translate(0,0); } 100% { transform: translate(30px, 110vh); } }

        .app-wrapper { display: flex; flex-direction: column; align-items: center; padding: 20px; width: 100%; box-sizing: border-box; }
        header { width: 100%; max-width: 700px; display: flex; gap: 15px; align-items: center; margin-bottom: 30px; }
        .search-container { flex: 1; display: flex; gap: 10px; background: rgba(18,18,20,0.15); padding: 12px 20px; border-radius: 30px; backdrop-filter: blur(15px); border: 1px solid rgba(255,255,255,0.1); align-items: center; }
        .search-container input { background: transparent; border: none; color: white; flex: 1; outline: none; font-size: 1.1rem; width: 100%; font-family: inherit; }
        .icon-btn { background: none; border: none; color: white; cursor: pointer; font-size: 1.8rem; display: flex; align-items: center; transition: 0.2s; filter: brightness(0.3) drop-shadow(0px 2px 2px rgba(0,0,0,0.5)); }
        .icon-btn:disabled { opacity: 0.3; cursor: not-allowed; }
        #landing-page { text-align: center; margin-top: 10vh; max-width: 400px; padding: 20px; }
        .btn-gps { background: var(--blue); border: none; padding: 18px 35px; border-radius: 50px; color: #000; font-weight: 800; cursor: pointer; margin-top: 25px; display: flex; align-items: center; gap: 12px; font-size: 1.1rem; box-shadow: 0 10px 25px rgba(56,189,248,0.4); width: 100%; justify-content: center; }
        #main-display { width: 100%; max-width: 600px; display: none; text-align: center; animation: fadeIn 0.8s ease; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .temp-hero { font-size: clamp(6.5rem, 28vw, 9rem); font-weight: 600; margin: 0; letter-spacing: -6px; line-height: 0.9; }
        .details-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(160px, 1fr)); gap: 15px; margin: 35px 0; width: 100%; }
        .card { background: rgba(0,0,0,0.25); padding: 22px; border-radius: 32px; border: 1px solid rgba(255,255,255,0.08); display: flex; flex-direction: column; align-items: center; backdrop-filter: blur(10px); }
        .status-badge { padding: 4px 12px; border-radius: 10px; font-size: 0.75rem; font-weight: 800; text-transform: uppercase; margin-top: 10px; }
        .hum-circle { position: relative; width: 70px; height: 70px; }
        .hum-circle svg { transform: rotate(-90deg); width: 70px; height: 70px; }
        circle { fill: none; stroke-width: 6; stroke-linecap: round; }
        .bg-c { stroke: rgba(255,255,255,0.1); }
        .prog-c { stroke: var(--blue); stroke-dasharray: 188.5; stroke-dashoffset: 188.5; transition: 1.5s ease-out; }
        .uv-bar-bg { width: 100%; height: 6px; background: rgba(255,255,255,0.1); border-radius: 10px; margin-top: 12px; overflow: hidden; }
        .uv-bar-fill { height: 100%; width: 0%; transition: 1.5s; }
        .section-h { text-align: left; font-size: 0.85rem; opacity: 0.6; font-weight: 800; margin: 30px 0 15px 5px; letter-spacing: 1px; width: 100%; }

      .scroll-row { display: flex; gap: 15px; overflow-x: auto; padding-bottom: 10px; scrollbar-width: none; width: 100%; }
        .item-24h { min-width: 75px; background: rgba(255,255,255,0.07); padding: 18px 10px; border-radius: 25px; flex-shrink: 0; border: 1px solid rgba(255,255,255,0.05); }
        .daily-list { background: rgba(0,0,0,0.2); border-radius: 35px; padding: 15px 25px; width: 100%; box-sizing: border-box; }
        .daily-row { display: flex; justify-content: space-between; align-items: center; padding: 18px 0; border-bottom: 1px solid rgba(255,255,255,0.05); }
        #config-modal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.85); z-index: 100; justify-content: center; align-items: center; backdrop-filter: blur(10px); }
        .modal-content { background: #1e293b; padding: 35px; border-radius: 40px; width: 90%; max-width: 350px; text-align: center; }
        .lang-btn { width: 100%; padding: 18px; margin: 10px 0; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); color: white; border-radius: 20px; cursor: pointer; font-size: 1.1rem; font-family: inherit; }
    </style>
</head>
<body>
    <div id="lightning" class="lightning-flash"></div>
    <div id="bg-overlay"></div>
    <div id="night-overlay" class="night-mask"></div>
    <div id="weather-canvas"></div>
    <div class="app-wrapper">
        <header>
            <div class="search-container">
                <input type="text" id="citySearch" placeholder="Search city...">
                <button id="btnSearch" class="icon-btn" onclick="search()"><i class="ph-bold ph-magnifying-glass"></i></button>
            </div>
            <button class="icon-btn" onclick="toggleModal()"><i class="ph-bold ph-gear-six"></i></button>
        </header>
        <div id="landing-page">
            <i class="ph-bold ph-cloud-sun" style="font-size: 6rem; color: var(--blue);"></i>
            <h2 id="txt-welcome">It appears you haven't searched yet</h2>
            <button class="btn-gps" onclick="getByGPS()">
                <i class="ph-bold ph-navigation-arrow"></i>
                <span id="txt-gps">Use My Location</span>
            </button>
        </div>
        <div id="main-display">
            <div id="city-name" style="font-size: 1.6rem; opacity: 0.8; font-weight: 300;">---</div>
            <h1 class="temp-hero" id="main-temp">--°</h1>
            <div id="main-desc" style="font-weight: 800; letter-spacing: 3px; color: var(--blue); text-transform: uppercase;">---</div>
            <div class="details-grid">
                <div class="card">
                    <i class="ph ph-thermometer-hot" style="color:var(--blue); font-size:1.8rem"></i>
                    <small id="txt-feels" style="margin-top:8px; opacity:0.6">FEELS LIKE</small>
                    <b id="val-feels" style="font-size: 1.8rem; margin: 5px 0;">--°</b>
                    <span id="badge-feels" class="status-badge">---</span>
                </div>
                <div class="card">
                    <div class="hum-circle">
                        <svg><circle class="bg-c" cx="35" cy="35" r="30"></circle><circle id="hum-prog" class="prog-c" cx="35" cy="35" r="30"></circle></svg>
                        <div style="position:absolute; inset:0; display:flex; align-items:center; justify-content:center; font-size:1rem; font-weight:600" id="val-hum">0%</div>
                    </div>
                    <small style="opacity:0.6; margin-top:10px">HUMIDITY</small>
                </div>
                <div class="card">
                    <div style="width:100%; display:flex; justify-content:space-between; align-items:center">
                        <i class="ph ph-sun-dim" style="color:#facc15; font-size:1.8rem"></i>
                        <span id="badge-uv" class="status-badge" style="margin:0">---</span>
                    </div>
                    <div style="width:100%; text-align:left; margin-top:12px">
                        <small id="txt-uv" style="opacity:0.6">UV INDEX</small><br>
                        <b id="val-uv" style="font-size: 1.8rem;">--</b>
                    </div>
                    <div class="uv-bar-bg"><div id="uv-fill" class="uv-bar-fill"></div></div>
                </div>
                <div class="card">
                    <i class="ph ph-wind" style="color:#a78bfa; font-size:1.8rem"></i>
                    <small style="opacity:0.6; margin-top:8px">PRESSURE</small>
                    <b id="val-pres" style="font-size: 1.3rem; margin-top:8px">-- hPa</b>
                </div>
            </div>

            <div class="info-card">
    <small>CLOUD COVER</small>
    <div id="cloud-frame" style="position:relative; width:100%; height:70px; overflow:hidden; border-radius:12px; margin-top:10px; background:#38bdf8; border:1px solid rgba(255,255,255,0.1);"></div>
    
    <div style="display:flex; gap:2px; height:8px; margin-top:12px; border-radius:4px; overflow:hidden;">
        <div style="flex:1; background:#38bdf8;"></div>
        <div style="flex:1; background:#0ea5e9;"></div>
        <div style="flex:1; background:#0284c7;"></div>
        <div style="flex:1; background:#0369a1;"></div>
        <div style="flex:1; background:#0c4a6e;"></div>
        <div style="flex:1; background:#111827;"></div>
        <div style="flex:1; background:#000000;"></div>
    </div>
    
    <div style="display:flex; justify-content:space-between; width:100%; margin-top:5px;">
        <small style="font-size:10px; opacity:0.7;">Clean</small>
        <b id="val-cloud" style="font-size:14px;">0%</b>
        <small style="font-size:10px; opacity:0.7;">Closed</small>
    </div>
            </div>
            
            <div class="section-h" id="txt-title-24">24 HOURS FORECAST</div>
            <div class="scroll-row" id="hourly-list"></div>
            <div class="section-h" id="txt-title-7">7 DAYS FORECAST</div>
            <div class="daily-list" id="daily-list"></div>
        </div>
    </div>
    <div id="config-modal">
        <div class="modal-content">
            <h2 style="margin:0 0 25px">Language</h2>
            <button class="lang-btn" onclick="setLang('en')">English</button>
            <button class="lang-btn" onclick="setLang('pt-br')">Português (Brasil)</button>
            <button class="lang-btn" onclick="setLang('pt-pt')">Português (Portugal)</button>
            <button class="lang-btn" onclick="setLang('es')">Español</button>
            <button onclick="toggleModal()" style="background:none; border:none; color:var(--blue); margin-top:20px; cursor:pointer; font-weight:bold">Close</button>
        </div>
    </div>
    <script>
        const translations = {
    'en': { 
        welcome: "It appears you haven't searched yet", gps: "Use My Location", feels: "FEELS LIKE", uv: "UV INDEX", t24: "24 HOURS FORECAST", t7: "7 DAYS FORECAST", 
        st: { great: "Great", good: "Good", mod: "Moderate", bad: "Bad", horrible: "Horrible", danger: "Dangerous" }, 
        desc: { 
            1000: "Sunny", 1003: "Mostly clear", 1006: "Partly cloudy", 1009: "Cloudy", 
            1030: "Mist", 1135: "Fog", 1063: "Patchy rain possible",
            1183: "Light rain", 1189: "Moderate rain", 1195: "Heavy rain", 
            1240: "Light rain showers", 1243: "Rain showers", 1246: "Heavy rain showers",
            1087: "Thunderstorm", 1273: "Scattered thunderstorms", 1276: "Heavy thunderstorm",
            1213: "Light snow", 1219: "Snow", 1225: "Heavy snow", 1237: "Ice pellets",
            1255: "Snow showers", 1114: "Blowing snow", 1204: "Light sleet", 1201: "Moderate rain"
        } 
    },
    'pt-br': { 
        welcome: "Parece que você ainda não pesquisou", gps: "Usar Minha Localização", feels: "SENSAÇÃO", uv: "ÍNDICE UV", t24: "PREVISÃO 24 HORAS", t7: "PREVISÃO 7 DIAS", 
        st: { great: "Ótimo", good: "Bom", mod: "Médio", bad: "Péssimo", horrible: "Horrível", danger: "Perigoso" }, 
        desc: { 
            1000: "Sol", 1003: "Sol com pouca nuvem", 1006: "Parcialmente nublado", 1009: "Nublado total", 
            1030: "Névoa", 1135: "Nevoeiro denso", 1063: "Possibilidade de chuva",
            1183: "Chuva leve", 1189: "Chuva moderada", 1195: "Chuva intensa", 
            1240: "Pancadas leves", 1243: "Pancadas de chuva", 1246: "Pancadas fortes",
            1087: "Trovoada", 1273: "Tempestades esparsas", 1276: "Tempestade pesada",
            1213: "Pouca neve", 1219: "Neve moderada", 1225: "Neve intensa", 1237: "Granizo",
            1255: "Pancadas de neve", 1114: "Neve com vento", 1204: "Chuva com gelo", 1201: "Vento com chuva"
        } 
    },
    'pt-pt': { 
        welcome: "Parece que ainda não pesquisou", gps: "Usar Minha Localização", feels: "SENSAÇÃO", uv: "ÍNDICE UV", t24: "PREVISÃO 24 HORAS", t7: "PREVISÃO 7 DIAS", 
        st: { great: "Excelente", good: "Bom", mod: "Moderado", bad: "Mau", horrible: "Horrível", danger: "Perigo" }, 
        desc: { 
            1000: "Sol", 1003: "Sol com poucas nuvens", 1006: "Parcialmente nublado", 1009: "Muito nublado", 
            1030: "Neblina", 1135: "Nevoeiro", 1063: "Possibilidade de aguaceiros",
            1183: "Chuva fraca", 1189: "Chuva", 1195: "Chuva forte", 
            1240: "Aguaceiros fracos", 1243: "Aguaceiros", 1246: "Aguaceiros fortes",
            1087: "Trovoada", 1273: "Trovoadas esparsas", 1276: "Trovoada forte",
            1213: "Neve fraca", 1219: "Neve", 1225: "Neve forte", 1237: "Granizo",
            1255: "Aguaceiros de neve", 1114: "Neve com vento", 1204: "Sleet", 1201: "Vento e chuva"
        } 
    },
    'es': { 
        welcome: "Parece que aún no has buscado", gps: "Usar Mi Ubicación", feels: "SENSACIÓN", uv: "ÍNDICE UV", t24: "PRONÓSTICO 24 HORAS", t7: "PRONÓSTICO 7 DÍAS", 
        st: { great: "Excelente", good: "Bien", mod: "Moderado", bad: "Pésimo", horrible: "Horrible", danger: "Peligro" }, 
        desc: { 
            1000: "Soleado", 1003: "Sol con pocas nubes", 1006: "Parcialmente nublado", 1009: "Nublado", 
            1030: "Niebla", 1135: "Neblina densa", 1063: "Posibilidad de lluvia",
            1183: "Lluvia ligera", 1189: "Lluvia moderada", 1195: "Lluvia intensa", 
            1240: "Chubascos ligeros", 1243: "Chubascos", 1246: "Chubascos fuertes",
            1087: "Tormenta", 1273: "Tormentas dispersas", 1276: "Tormenta pesada",
            1213: "Nieve ligera", 1219: "Nieve", 1225: "Nieve intensa", 1237: "Granizo",
            1255: "Chubascos de nieve", 1114: "Nieve con viento", 1204: "Lluvia y nieve", 1201: "Viento con lluvia"
        } 
    }
};
        
        


            const weatherMeta = { 
    // --- GRUPO: CÉU LIMPO E SOL ---
    1000: { 
        dayIcon: 'https://raw.githubusercontent.com/mrdarrengriffin/google-weather-icons/main/v4/clear_day.svg', 
        nightIcon: 'https://raw.githubusercontent.com/mrdarrengriffin/google-weather-icons/main/v4/clear_night.svg', 
        bg: 'linear-gradient(to bottom, #7dd3fc 0%, #0ea5e9 100%)', type: 'sun', pCount: 0 
    }, 

    // --- GRUPO: PARCIALMENTE NUBLADO (Sol entre nuvens) ---
    1003: { 
        dayIcon: 'https://raw.githubusercontent.com/mrdarrengriffin/google-weather-icons/main/v4/mostly_clear_day.svg', 
        nightIcon: 'https://raw.githubusercontent.com/mrdarrengriffin/google-weather-icons/main/v4/mostly_clear_night.svg', 
        bg: 'linear-gradient(to bottom, #bae6fd 0%, #38bdf8 100%)', type: 'cloud', pCount: 4 
    },
    1006: { 
        dayIcon: 'https://raw.githubusercontent.com/mrdarrengriffin/google-weather-icons/main/v4/partly_cloudy_day.svg', 
        nightIcon: 'https://raw.githubusercontent.com/mrdarrengriffin/google-weather-icons/main/v4/partly_cloudy_night.svg', 
        bg: 'linear-gradient(to bottom, #94a3b8 0%, #64748b 100%)', type: 'cloud', pCount: 5 
    },

    // --- GRUPO: NUBLADO TOTAL (Céu cinza) ---
    1009: { 
        dayIcon: 'https://raw.githubusercontent.com/mrdarrengriffin/google-weather-icons/main/v4/cloudy.svg', 
        nightIcon: 'https://raw.githubusercontent.com/mrdarrengriffin/google-weather-icons/main/v4/cloudy.svg', 
        bg: 'linear-gradient(to bottom, #cbd5e1 0%, #64748b 100%)', type: 'cloud', pCount: 8 
    },

    // --- GRUPO: NEVOEIRO E NEBLINA ---
    1030: { 
        dayIcon: 'https://raw.githubusercontent.com/mrdarrengriffin/google-weather-icons/main/v4/haze_fog_dust_smoke.svg', 
        nightIcon: 'https://raw.githubusercontent.com/mrdarrengriffin/google-weather-icons/main/v4/haze_fog_dust_smoke.svg', 
        bg: 'linear-gradient(to bottom, #94a3b8 0%, #cbd5e1 100%)', type: 'cloud', pCount: 10 
    },

    // --- GRUPO: CHUVAS LEVES E PANCADAS RÁPIDAS ---
    1240: { 
        dayIcon: 'https://raw.githubusercontent.com/mrdarrengriffin/google-weather-icons/main/v4/scattered_showers_day.svg', 
        nightIcon: 'https://raw.githubusercontent.com/mrdarrengriffin/google-weather-icons/main/v4/scattered_showers_night.svg', 
        bg: 'linear-gradient(to bottom, #94a3b8 0%, #475569 100%)', particle: 'rain', pCount: 40 
    }, 
    1183: { 
        dayIcon: 'https://raw.githubusercontent.com/mrdarrengriffin/google-weather-icons/main/v4/drizzle.svg', 
        nightIcon: 'https://raw.githubusercontent.com/mrdarrengriffin/google-weather-icons/main/v4/drizzle.svg', 
        bg: 'linear-gradient(to bottom, #94a3b8 0%, #475569 100%)', particle: 'rain', pCount: 60 
    }, 

    // --- GRUPO: CHUVA MODERADA ---
    1243: { 
        dayIcon: 'https://raw.githubusercontent.com/mrdarrengriffin/google-weather-icons/main/v4/scattered_showers_day.svg', 
        nightIcon: 'https://raw.githubusercontent.com/mrdarrengriffin/google-weather-icons/main/v4/scattered_showers_night.svg', 
        bg: 'linear-gradient(to bottom, #475569 0%, #1e293b 100%)', particle: 'rain', pCount: 120 
    },
    1189: { 
        dayIcon: 'https://raw.githubusercontent.com/mrdarrengriffin/google-weather-icons/main/v4/showers_rain.svg', 
        nightIcon: 'https://raw.githubusercontent.com/mrdarrengriffin/google-weather-icons/main/v4/showers_rain.svg', 
        bg: 'linear-gradient(to bottom, #475569 0%, #1e293b 100%)', particle: 'rain', pCount: 120 
    },

    // --- GRUPO: CHUVA PESADA E INTENSA ---
    1195: { 
        dayIcon: 'https://raw.githubusercontent.com/mrdarrengriffin/google-weather-icons/main/v4/heavy_rain.svg', 
        nightIcon: 'https://raw.githubusercontent.com/mrdarrengriffin/google-weather-icons/main/v4/heavy_rain.svg', 
        bg: 'linear-gradient(to bottom, #1e293b 0%, #020617 100%)', particle: 'rain', pCount: 250 
    }, 
    1246: { 
        dayIcon: 'https://raw.githubusercontent.com/mrdarrengriffin/google-weather-icons/main/v4/scattered_showers_day.svg', 
        nightIcon: 'https://raw.githubusercontent.com/mrdarrengriffin/google-weather-icons/main/v4/scattered_showers_night.svg', 
        bg: 'linear-gradient(to bottom, #1e293b 0%, #020617 100%)', particle: 'rain', pCount: 250 
    }, 
                    
    // --- GRUPO: NEVE E GRANIZO ---
    1237: { 
        dayIcon: 'https://raw.githubusercontent.com/mrdarrengriffin/google-weather-icons/main/v4/sleet_hail.svg', 
        nightIcon: 'https://raw.githubusercontent.com/mrdarrengriffin/google-weather-icons/main/v4/sleet_hail.svg', 
        bg: 'linear-gradient(to bottom, #475569 0%, #94a3b8 100%)', particle: 'snow', pCount: 100
    },
    1213: { 
        dayIcon: 'https://raw.githubusercontent.com/mrdarrengriffin/google-weather-icons/main/v4/flurries.svg', 
        nightIcon: 'https://raw.githubusercontent.com/mrdarrengriffin/google-weather-icons/main/v4/flurries.svg', 
        bg: 'linear-gradient(to bottom, #ffffff 0%, #94a3b8 100%)', particle: 'snow', pCount: 60 
    },
    1219: { 
        dayIcon: 'https://raw.githubusercontent.com/mrdarrengriffin/google-weather-icons/main/v4/showers_snow.svg', 
        nightIcon: 'https://raw.githubusercontent.com/mrdarrengriffin/google-weather-icons/main/v4/showers_snow.svg', 
        bg: 'linear-gradient(to bottom, #ffffff 0%, #cbd5e1 100%)', particle: 'snow', pCount: 120 
    },
    1225: { 
        dayIcon: 'https://raw.githubusercontent.com/mrdarrengriffin/google-weather-icons/main/v4/heavy_snow.svg', 
        nightIcon: 'https://raw.githubusercontent.com/mrdarrengriffin/google-weather-icons/main/v4/heavy_snow.svg', 
        bg: 'linear-gradient(to bottom, #ffffff 0%, #cbd5e1 100%)', particle: 'snow', pCount: 160 
    },
   // -- neve (sol com neve)
   1255: { 
        dayIcon: 'https://raw.githubusercontent.com/mrdarrengriffin/google-weather-icons/main/v4/scattered_snow_showers_day.svg', 
        nightIcon: 'https://raw.githubusercontent.com/mrdarrengriffin/google-weather-icons/main/v4/scattered_snow_showers_night.svg', 
        bg: 'linear-gradient(to bottom, #ffffff 0%, #cbd5e1 100%)', particle: 'snow', pCount: 100
    },

    1258: { 
        dayIcon: 'https://raw.githubusercontent.com/mrdarrengriffin/google-weather-icons/main/v4/scattered_snow_showers_day.svg', 
        nightIcon: 'https://raw.githubusercontent.com/mrdarrengriffin/google-weather-icons/main/v4/scattered_snow_showers_night.svg', 
        bg: 'linear-gradient(to bottom, #ffffff 0%, #cbd5e1 100%)', particle: 'snow', pCount: 100
    },
    // chuva com gelos e gotas
    1201: { 
        dayIcon: 'https://raw.githubusercontent.com/mrdarrengriffin/google-weather-icons/main/v4/mixed_rain_hail_sleet.svg', 
        nightIcon: 'https://raw.githubusercontent.com/mrdarrengriffin/google-weather-icons/main/v4/mixed_rain_hail_sleet.svg', 
        bg: 'linear-gradient(to bottom, #1e293b 0%, #020617 100%)', particle: 'rain', pCount: 200
    }, 
                    
    // --- GRUPO: TEMPESTADES E RAIOS ---
    1087: { 
        dayIcon: 'https://raw.githubusercontent.com/mrdarrengriffin/google-weather-icons/main/v4/isolated_thunderstorms.svg', 
        nightIcon: 'https://raw.githubusercontent.com/mrdarrengriffin/google-weather-icons/main/v4/isolated_thunderstorms.svg', 
        bg: 'linear-gradient(to bottom, #475569 0%, #1e293b 100%)', particle: 'rain', storm: true, pCount: 150 
    },
   1273: { 
        dayIcon: 'https://raw.githubusercontent.com/mrdarrengriffin/google-weather-icons/main/v4/strong_thunderstorms.svg', 
        nightIcon: 'https://raw.githubusercontent.com/mrdarrengriffin/google-weather-icons/main/v4/strong_thunderstorms.svg', 
        bg: 'linear-gradient(to bottom, #020617 0%, #1e293b 100%)', particle: 'rain', storm: true, pCount: 300 
    },
    1276: { 
        dayIcon: 'https://raw.githubusercontent.com/mrdarrengriffin/google-weather-icons/main/v4/strong_thunderstorms.svg', 
        nightIcon: 'https://raw.githubusercontent.com/mrdarrengriffin/google-weather-icons/main/v4/strong_thunderstorms.svg', 
        bg: 'linear-gradient(to bottom, #020617 0%, #1e293b 100%)', particle: 'rain', storm: true, pCount: 300 
    } 
};
        
        
        
        

        let currentLang = localStorage.getItem('lang') || navigator.language.split('-')[0] || 'en';
        if(!translations[currentLang]) currentLang = 'en';

        function applyLang() { 
            const t = translations[currentLang]; 
            document.getElementById('txt-welcome').innerText = t.welcome; 
            document.getElementById('txt-gps').innerText = t.gps; 
            document.getElementById('txt-feels').innerText = t.feels; 
            document.getElementById('txt-uv').innerText = t.uv; 
            document.getElementById('txt-title-24').innerText = t.t24; 
            document.getElementById('txt-title-7').innerText = t.t7; 
            document.getElementById('citySearch').placeholder = currentLang.startsWith('pt') ? "Buscar cidade..." : "Search city..."; 
        }

        function getStatusLabels(val, type) { 
            const s = translations[currentLang].st; 
            if (type === 'uv') { 
                if (val <= 2) return { text: s.great, color: '#38bdf8' }; 
                if (val <= 5) return { text: s.good, color: '#4ade80' }; 
                if (val <= 7) return { text: s.mod, color: '#facc15' }; 
                if (val <= 10) return { text: s.bad, color: '#fb923c' }; 
                return { text: s.horrible, color: '#f87171' }; 
            } else { 
                if (val >= 38 || val <= -15) return { text: s.danger, color: '#f87171' }; 
                if (val >= 32 || (val < -10 && val > -15)) return { text: s.bad, color: '#fb923c' }; 
                if (val >= 27 || (val < 0 && val >= -10)) return { text: s.good, color: '#facc15' }; 
                if (val >= 20 && val < 27) return { text: s.great, color: '#38bdf8' }; 
                return { text: s.mod, color: '#4ade80' }; 
            } 
        }

        function updateVisuals(code) { 
    const meta = weatherMeta[code] || weatherMeta[3]; 
    const canvas = document.getElementById('weather-canvas'); 
    const overlay = document.getElementById('bg-overlay'); 
    const night = document.getElementById('night-overlay'); 
    const lightning = document.getElementById('lightning');

    canvas.innerHTML = ''; 
    overlay.style.background = meta.bg; 
    const hr = new Date().getHours(); 
    night.style.display = (hr >= 18 || hr <= 6) ? 'block' : 'none'; 
    
    lightning.style.animation = meta.storm ? "flash 4s infinite" : "none";

    if(meta.type === 'cloud' || meta.storm) {
        for(let i=0; i<4; i++) {
            const c = document.createElement('div');
            c.className = 'cloud-element';
            c.style.width = (Math.random() * 200 + 200) + 'px';
            c.style.height = '100px';
            c.style.top = (Math.random() * 40) + '%';
            c.style.animationDuration = (Math.random() * 20 + 20) + 's';
            c.style.animationDelay = (Math.random() * 10) + 's';
            canvas.appendChild(c);
        }
    }

    if(meta.particle) { 
        for(let i=0; i<60; i++) { 
            const p = document.createElement('div'); 
            p.className = meta.particle === 'rain' ? 'rain-drop' : 'snow-flake'; 
            p.style.left = Math.random() * 100 + '%'; 
            p.style.animationDuration = (Math.random() * (meta.particle==='snow'?3:0.7) + 0.5) + 's'; 
            p.style.animationDelay = Math.random() * 2 + 's'; 
            canvas.appendChild(p); 
        } 
    }

        // --- LÓGICA DE CORES E ÍCONES ---
    const isNight = (hr >= 18 || hr <= 6);
    const iconUrl = isNight ? meta.nightIcon : meta.dayIcon;
    const descText = translations[currentLang].desc[code] || translations[currentLang].desc[3];

    // Troca o texto pelo Ícone + Texto
    document.getElementById('main-desc').innerHTML = `
        <img src="${iconUrl}" style="width:45px; vertical-align:middle; margin-right:10px">
        <span>${descText}</span>
    `;

    // Ajuste de contraste do texto da busca
    const isDarkText = (code === 3 || code === 71);
    const uiColor = isDarkText ? "#000000" : "#ffffff";
    document.getElementById('citySearch').style.color = uiColor;
    document.querySelectorAll('.icon-btn').forEach(btn => btn.style.color = uiColor);

    return descText; 
        }
        
        

        async function fetchWeather(lat, lon, name) { 
    const btn = document.getElementById('btnSearch'); 
    btn.disabled = true; 
    try { 
        const w = await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current=temperature_2m,apparent_temperature,weather_code,relative_humidity_2m,uv_index,pressure_msl&hourly=temperature_2m,weather_code&daily=weather_code,temperature_2m_max,temperature_2m_min&timezone=auto`).then(r=>r.json()); 
        
        document.getElementById('landing-page').style.display = 'none'; 
        document.getElementById('main-display').style.display = 'block'; 
        document.getElementById('city-name').innerText = name; 
        document.getElementById('main-temp').innerText = Math.round(w.current.temperature_2m) + "°"; 
        document.getElementById('val-pres').innerText = Math.round(w.current.pressure_msl) + " hPa"; 
        
        // Atualiza visual e pega o texto da descrição
        const desc = updateVisuals(w.current.weather_code);
        // O ícone principal já é injetado pelo updateVisuals no main-desc, 
        // então aqui apenas garantimos que o texto esteja correto se necessário.

        const fVal = Math.round(w.current.apparent_temperature); 
        const fStat = getStatusLabels(fVal, 'temp'); 
        document.getElementById('val-feels').innerText = fVal + "°"; 
        document.getElementById('badge-feels').innerText = fStat.text; 
        document.getElementById('badge-feels').style.background = fStat.color; 
        
        const hum = w.current.relative_humidity_2m; 
        document.getElementById('val-hum').innerText = hum + "%"; 
        const clPct = d.current.cloud;
document.getElementById('val-cloud').innerText = clPct + "%";
const cFr = document.getElementById('cloud-frame');
cFr.innerHTML = '';
// Ajusta a cor do frame: do azul (dia) ao preto (conforme nuvens e se for noite)
const brght = d.current.is_day ? (70 - (clPct * 0.4)) : (20 - (clPct * 0.2));
cFr.style.background = `hsl(200, 90%, ${brght}%)`;

// Sua tabela de lógica
let nCnt = 0, nSpd = 30;
if(clPct >= 100) { nCnt = 30; nSpd = 4; }
else if(clPct >= 95) { nCnt = 22; nSpd = 8; }
else if(clPct >= 85) { nCnt = 20; nSpd = 9; }
else if(clPct >= 70) { nCnt = 17; nSpd = 10; }
else if(clPct >= 50) { nCnt = 10; nSpd = 14; }
else if(clPct >= 35) { nCnt = 7; nSpd = 16; }
else if(clPct >= 20) { nCnt = 5; nSpd = 17; }
else if(clPct >= 10) { nCnt = 4; nSpd = 17; }
else if(clPct > 0) { nCnt = 2; nSpd = 20; }
else if(clPct === 0) { nCnt = 1; nSpd = 30; }

// Gerar nuvens no frame
for(let i=0; i<nCnt; i++) {
    const cloudImg = document.createElement('img');
    cloudImg.src = weatherMeta[1009].dayIcon; // Usa seu ícone de nuvem
    cloudImg.className = 'frame-cloud-icon';
    cloudImg.style.top = Math.random() * 60 + "%";
    cloudImg.style.width = (Math.random() * 20 + 15) + "px";
    cloudImg.style.opacity = d.current.is_day ? "0.9" : "0.4";
    cloudImg.style.animationDuration = (Math.random() * 5 + nSpd) + "s";
    cloudImg.style.animationDelay = `-${Math.random() * 25}s`;
    cFr.appendChild(cloudImg);
}
        document.getElementById('hum-prog').style.strokeDashoffset = 188.5 - (188.5 * hum / 100); 
        
        const uv = w.current.uv_index; 
        const uStat = getStatusLabels(uv, 'uv'); 
        document.getElementById('val-uv').innerText = uv; 
        document.getElementById('badge-uv').innerText = uStat.text; 
        document.getElementById('badge-uv').style.background = uStat.color; 
        document.getElementById('uv-fill').style.background = uStat.color; 
        document.getElementById('uv-fill').style.width = Math.min((uv/11)*100, 100) + "%"; 
        
        // --- LISTA 24 HORAS CORRIGIDA ---
        const hList = document.getElementById('hourly-list'); 
        hList.innerHTML = ''; 
        const nowH = new Date().getHours(); 
        for(let i = nowH; i < nowH + 24; i++) { 
            const hCode = w.hourly.weather_code[i]; 
            const hour = i % 24;
            const isNight = (hour >= 18 || hour <= 6);
            const meta = weatherMeta[hCode] || weatherMeta[3];
            const iconUrl = isNight ? meta.nightIcon : meta.dayIcon;

            hList.innerHTML += `
                <div class="item-24h">
                    <small>${hour}:00</small><br>
                    <img src="${iconUrl}" style="width:30px; margin:8px 0; display:inline-block">
                    <br><b>${Math.round(w.hourly.temperature_2m[i])}°</b>
                </div>`; 
        } 
        
        // --- LISTA 7 DIAS CORRIGIDA ---
        const dList = document.getElementById('daily-list'); 
        dList.innerHTML = ''; 
        w.daily.time.forEach((day, i) => { 
            const date = new Date(day + "T00:00:00"); 
            const dCode = w.daily.weather_code[i]; 
            const meta = weatherMeta[dCode] || weatherMeta[3];
            
            dList.innerHTML += `
                <div class="daily-row">
                    <span style="flex:1; text-align:left; font-weight:600; text-transform:capitalize">
                        ${date.toLocaleDateString(currentLang, {weekday:'long'})}
                    </span>
                    <img src="${meta.dayIcon}" style="width:28px; margin:0 10px">
                    <b style="width:60px; text-align:right; font-size:1.1rem">
                        ${Math.round(w.daily.temperature_2m_max[i])}°
                    </b>
                </div>`; 
        }); 

    } catch(e) { 
        console.error(e); 
    } finally { 
        btn.disabled = false; 
    } 
        }
        
        async function search(){const v=document.getElementById('citySearch').value;if(!v)return;const btn=document.getElementById('btnSearch');btn.disabled=true;try{const d=await fetch(`https://api.weatherapi.com/v1/forecast.json?key=5da6a9677624447a8d8145541261202&q=${encodeURIComponent(v)}&days=7&lang=pt`).then(r=>r.json());if(d.error)throw d.error;const c=d.current,f=d.forecast.forecastday,now=new Date(),hr=now.getHours();document.getElementById('landing-page').style.display='none';document.getElementById('main-display').style.display='block';document.getElementById('city-name').innerText=d.location.name;document.getElementById('main-temp').innerText=Math.round(c.temp_c)+"°";document.getElementById('val-pres').innerText=c.pressure_mb+" hPa";updateVisuals(c.condition.code);const cl=c.cloud,cf=document.getElementById('cloud-frame');if(cf){document.getElementById('val-cloud').innerText=cl+"%";cf.innerHTML='';cf.style.background=`hsl(200,90%,${c.is_day?(100-(cl*0.6)):(20-(cl*0.2))}%)`;let nC=0,nS=30;if(cl>=100){nC=30;nS=4}else if(cl>=95){nC=22;nS=8}else if(cl>=85){nC=20;nS=9}else if(cl>=70){nC=17;nS=10}else if(cl>=50){nC=10;nS=14}else if(cl>=35){nC=7;nS=16}else if(cl>=20){nC=5;nS=17}else if(cl>=10){nC=4;nS=17}else if(cl>0){nC=2;nS=20}for(let i=0;i<nC;i++){const img=document.createElement('img');img.src=(weatherMeta[1009]||weatherMeta[1000]).dayIcon;img.className='frame-cloud-icon';img.style.cssText=`position:absolute;top:${Math.random()*60}%;width:${Math.random()*20+15}px;opacity:${c.is_day?0.9:0.4};animation:moveCloud ${Math.random()*5+nS}s linear infinite;animation-delay:-${Math.random()*20}s`;cf.appendChild(img)}}const fS=getStatusLabels(Math.round(c.feelslike_c),'temp'),uS=getStatusLabels(c.uv,'uv');document.getElementById('val-feels').innerText=Math.round(c.feelslike_c)+"°";document.getElementById('badge-feels').innerText=fS.text;document.getElementById('badge-feels').style.background=fS.color;document.getElementById('val-uv').innerText=c.uv;document.getElementById('badge-uv').innerText=uS.text;document.getElementById('badge-uv').style.background=uS.color;document.getElementById('uv-fill').style.width=Math.min((c.uv/11)*100,100)+"%";document.getElementById('uv-fill').style.background=uS.color;document.getElementById('val-hum').innerText=c.humidity+"%";document.getElementById('hum-prog').style.strokeDashoffset=188.5-(188.5*c.humidity/100);let hH='',dH='',allH=[...f[0].hour,...(f[1]?f[1].hour:[])];for(let i=0;i<24;i++){const idx=hr+i,h=allH[idx];if(h){const m=weatherMeta[h.condition.code]||weatherMeta[1000],isN=(idx%24>=18||idx%24<=6);hH+=`<div class="item-24h"><small>${idx%24}:00</small><br><b>${Math.round(h.temp_c)}°</b><br><img src="${isN?m.nightIcon:m.dayIcon}" width="30"></div>`}}f.forEach(day=>{const m=weatherMeta[day.day.condition.code]||weatherMeta[1000],dt=new Date(day.date+'T00:00:00').toLocaleDateString(currentLang,{weekday:'short'});dH+=`<div class="daily-row"><span>${dt}</span><img src="${m.dayIcon}" width="30"><span><b>${Math.round(day.day.maxtemp_c)}°</b> / ${Math.round(day.day.mintemp_c)}°</span></div>`});document.getElementById('hourly-list').innerHTML=hH;document.getElementById('daily-list').innerHTML=dH}catch(e){console.error(e);alert("This city does not exist yet, or there was an error on the Weather API server.")}finally{btn.disabled=false}}
        function updateWeatherStyle(c,d){const m=weatherMeta[c]||weatherMeta[1000];document.getElementById('bg-overlay').style.background=m.bg;document.getElementById('night-overlay').style.display=d?'none':'block';const hero=document.querySelector('.temp-hero');const oldImg=hero.querySelector('img');if(oldImg)oldImg.remove();const img=document.createElement('img');img.src=d?m.dayIcon:m.nightIcon;img.style.width='clamp(4rem, 15vw, 6rem)';img.style.verticalAlign='middle';img.style.marginLeft='10px';hero.appendChild(img);if(m.storm)document.getElementById('lightning').style.animation='flash 3s infinite';else document.getElementById('lightning').style.animation='none';if(typeof initWeatherParticles==='function')initWeatherParticles(m.type||m.particle,m.pCount);}
        async function getByGPS(){navigator.geolocation.getCurrentPosition(async(p)=>{try{const{latitude:lt,longitude:lg}=p.coords,g=await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${lt}&lon=${lg}`).then(r=>r.json()),city=g.address.city||g.address.town||g.address.village||`${lt},${lg}`;document.getElementById('citySearch').value=city;search();}catch(e){alert("Erro na localização: "+e.message)}},{enableHighAccuracy:false,timeout:5000})}
        function toggleModal() { const m = document.getElementById('config-modal'); m.style.display = m.style.display==='flex'?'none':'flex'; }
        function setLang(l) { currentLang = l; localStorage.setItem('lang', l); applyLang(); toggleModal(); if(document.getElementById('main-display').style.display === 'block') search(); }
        
        applyLang();
    </script>
</body>
</html>
